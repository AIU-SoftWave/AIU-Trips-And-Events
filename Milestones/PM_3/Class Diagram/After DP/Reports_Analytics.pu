@startuml Reports_Analytics_layer

!define INTERFACE_COLOR #E8F5E9
!define SERVICE_COLOR #F3E5F5
!define ENTITY_COLOR #E3F2FD
!define ENUM_COLOR #F3E5F5
!define BUILDER_COLOR #FFF9C4

skinparam classAttributeIconSize 0
skinparam class {
    BackgroundColor<<interface>> INTERFACE_COLOR
    BackgroundColor<<service>> SERVICE_COLOR
    BackgroundColor<<entity>> ENTITY_COLOR
    BackgroundColor<<enum>> ENUM_COLOR
    BackgroundColor<<Builder>> BUILDER_COLOR
    BackgroundColor<<Product>> BUILDER_COLOR
}

package "Reports & Analytics Component" {
    
    ' Interface from Context Level
    interface IReportsAnalytics <<interface>> {
        +generateReport(reportType: ReportType, filters: ReportFilterDTO, format: ExportFormat): ReportDTO
        +exportReport(reportId: String, format: ExportFormat): FileDTO
        +getStatistics(): SystemStatisticsDTO
        +collectFeedback(feedbackData: FeedbackDTO): Response
    }

    class ReportService <<service>> {
        -RepositoryFactory repositoryFactory
        +generateReport(reportType: ReportType, filters: ReportFilterDTO, format: ExportFormat): ReportDTO
        +exportReport(reportId: String, format: ExportFormat): FileDTO
        +getStatistics(): SystemStatisticsDTO
        +collectFeedback(feedbackData: FeedbackDTO): Response
    }

    ' Abstract Factory from Repository Layer
    abstract class RepositoryFactory <<factory>> {
        +createRepository(): IBaseRepository
        #configureRepository(): void
    }
    ' ==================== REPORT BUILDER PATTERN (UPDATED) ====================
    package "Report Builder Pattern" {
        skinparam class {
            BackgroundColor<<Product>> BUILDER_COLOR
            BackgroundColor<<Builder>> BUILDER_COLOR
        }

        ' === Abstract Builder ===
        abstract class ReportBuilder <<Builder>> {
            #reportRepositoryFactory: RepositoryFactory
            #activityRepositoryFactory: RepositoryFactory
            #bookingRepositoryFactory: RepositoryFactory
            #feedbackRepositoryFactory: RepositoryFactory
            +{abstract} reset(): void
            +{abstract} buildHeader(): void
            +{abstract} buildBody(data: List): void
            +{abstract} buildFooter(stats: SystemStatisticsDTO): void
            +{abstract} getProduct(): ReportDTO
        }


        ' === Concrete Builders ===
        class PdfReportBuilder <<Builder>> {
            -report: ReportDTO
            +reset(): void
            +buildHeader(): void
            +buildBody(data: List): void
            +buildFooter(stats: SystemStatisticsDTO): void
            +getProduct(): ReportDTO
        }

        class CsvReportBuilder <<Builder>> {
            -report: ReportDTO
            +reset(): void
            +buildHeader(): void
            +buildBody(data: List): void
            +buildFooter(stats: SystemStatisticsDTO): void
            +getProduct(): ReportDTO
        }

        ' --- Relationships ---
        ReportBuilder <|-- PdfReportBuilder
        ReportBuilder <|-- CsvReportBuilder
        
        ' Repository Factory Relations
        ReportBuilder o-- RepositoryFactory : aggregation
    }

    ' --- External Relationships ---
    IReportsAnalytics <|.. ReportService : realizes
    ReportService o-- RepositoryFactory : aggregation
    ReportService o-- ReportBuilder : "uses (Director)"
}

@enduml
